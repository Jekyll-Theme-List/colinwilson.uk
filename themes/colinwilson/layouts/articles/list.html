{{ partialCached "header" . }}

<body class="rubik black-60">

  {{ partialCached "nav_mobile" . }}
  {{ partialCached "nav" . }}

  <div class="flex flex-column w-80 mw9 pv4 pv0-ns center">

    {{ if .Site.Params.Logo }}
    {{ partialCached "logo" . }}
    {{ end }}

    <div class="flex-auto flex flex-column justify-center pv4 pv5-ns">
      <h1 class="mt0 mb4 f3 f2-ns normal lh-copy lh-title-ns measure-narrow black-80">{{ .Title }}</h1>
    </div>

    {{ partialCached "noscript_warning" "Search function requires JavaScript." . }}
    <div class="mb4 f3 black-60" id="search-box">
      <!-- SearchBox widget will appear here -->
      <a id="algolia_logo" href="https://algolia.com" target="_blank" rel="noopener">
        <img alt="Algolia Search Brand Logo" style="margin-right: 30%;" height="19px" width="133px" class="fr pt1"
          src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNjggMjQiPjxkZWZzPjxzdHlsZT4uY2xzLTF7ZmlsbDpub25lO30uY2xzLTJ7ZmlsbDojNzM3MzczO30uY2xzLTN7ZmlsbDojNjc2NzY3O30uY2xzLTR7ZmlsbDojZmZmO308L3N0eWxlPjwvZGVmcz48dGl0bGU+c2VhcmNoLWJ5LWFsZ29saWEtZ3JheXNjYWxlPC90aXRsZT48cGF0aCBpZD0iY2FudmFzX2JhY2tncm91bmQiIGNsYXNzPSJjbHMtMSIgZD0iTS0xLTFoODAydjYwMmgtODAyeiIvPjxnIGlkPSJzdmdfMSI+PHBhdGggaWQ9InN2Z18yIiBjbGFzcz0iY2xzLTIiIGQ9Ik03OSAuOTRoMTYuNThhMyAzIDAgMCAxIDMgM3YxNi41NmEzIDMgMCAwIDEtMyAzaC0xNi41OGEzIDMgMCAwIDEtMy0zdi0xNi42YTMgMyAwIDAgMSAzLTN6bTQxLjkzIDE3Ljg2Yy00LjM5IDAtNC4zOS0zLjU0LTQuMzktNC4xdi0xMy4zNGwyLjY4LS40MnYxMy4yNWMwIC4zMiAwIDIuMzYgMS43MiAyLjM3em0tMTAuODUtMi4xOGE5LjUxIDkuNTEgMCAwIDAgMS44NS0uMTN2LTIuNzFhNS45MyA1LjkzIDAgMCAwLTEuNTctLjIgNS40NiA1LjQ2IDAgMCAwLS45LjA3IDIuMzYgMi4zNiAwIDAgMC0uODEuMjQgMS4zOSAxLjM5IDAgMCAwLS41OC40OS45Mi45MiAwIDAgMC0uMjIuNjUgMS4yOSAxLjI5IDAgMCAwIC42MSAxLjIzIDMuMTQgMy4xNCAwIDAgMCAxLjYyLjM2em0tLjIzLTkuN2E2LjYgNi42IDAgMCAxIDIuMjMuMzMgMy41NSAzLjU1IDAgMCAxIDEuNDQuOTIgMy41NCAzLjU0IDAgMCAxIC43NiAxLjQ4IDYuNyA2LjcgMCAwIDEgLjIzIDEuODV2Ni44N2MtLjYyLjEzLTEuMjQuMjMtMS44Ni4zMmEyMC4wNiAyMC4wNiAwIDAgMS0yLjgyLjE4IDguNDMgOC40MyAwIDAgMS0xLjg5LS4yIDMuOTMgMy45MyAwIDAgMS0xLjQ3LS42MyAzLjA4IDMuMDggMCAwIDEtMS0xLjE0IDQuMjIgNC4yMiAwIDAgMS0uMzUtMS44IDIuNzcgMi43NyAwIDAgMSAuMzktMS41MiAzLjE2IDMuMTYgMCAwIDEgMS0xLjExIDQuNCA0LjQgMCAwIDEgMS41NC0uNjEgOC40NSA4LjQ1IDAgMCAxIDEuODItLjE5IDguMjMgOC4yMyAwIDAgMSAyIC4yNHYtLjQ0YTMuNTEgMy41MSAwIDAgMC0uMTEtLjg3IDIgMiAwIDAgMC0uMzktLjczIDEuNzIgMS43MiAwIDAgMC0uNzItLjQ5IDMuMiAzLjIgMCAwIDAtMS4xNC0uMjEgMTAuNjcgMTAuNjcgMCAwIDAtMS42OS4xNiA3LjczIDcuNzMgMCAwIDAtMS4yNi4zMWwtLjMzLTIuMTlhMTEgMTEgMCAwIDEgMS40OC0uMzUgMTIuMDkgMTIuMDkgMCAwIDEgMi4wOC0uMTh6bTUyLjg0IDkuNjNhMTAuMzggMTAuMzggMCAwIDAgMS44NS0uMTN2LTIuNzJhNi4zNyA2LjM3IDAgMCAwLTEuNTctLjIgNS40NiA1LjQ2IDAgMCAwLS45LjA3IDIuODEgMi44MSAwIDAgMC0uODEuMjQgMS4zOSAxLjM5IDAgMCAwLS41OC40OS45NC45NCAwIDAgMC0uMjIuNjYgMS4yOSAxLjI5IDAgMCAwIC42MSAxLjIzIDMuMTYgMy4xNiAwIDAgMCAxLjYyLjM2em0tLjIzLTkuNjlhNi41MyA2LjUzIDAgMCAxIDIuMjMuMzIgMy41OSAzLjU5IDAgMCAxIDEuNDUuOTIgMy42NiAzLjY2IDAgMCAxIC43NiAxLjQ4IDYuOCA2LjggMCAwIDEgLjIzIDEuODV2Ni44OGMtLjQxLjA4LTEgLjE5LTEuODcuMzFhMTkuODEgMTkuODEgMCAwIDEtMi44MS4xOCA4LjYxIDguNjEgMCAwIDEtMS45LS4xOSA0IDQgMCAwIDEtMS40Ny0uNjQgMy4wNiAzLjA2IDAgMCAxLTEtMS4xMyA0LjQzIDQuNDMgMCAwIDEtLjM0LTEuODEgMi44NiAyLjg2IDAgMCAxIC4zOC0xLjUyIDMuMjggMy4yOCAwIDAgMSAxLjA1LTEuMTEgNC41NCA0LjU0IDAgMCAxIDEuNTMtLjYxIDguNzYgOC43NiAwIDAgMSAyLjc1LS4xMyA3LjEgNy4xIDAgMCAxIDEgLjE4di0uNDNhMy4yNyAzLjI3IDAgMCAwLS4xMS0uODggMS44MyAxLjgzIDAgMCAwLS4zOC0uNzMgMS44NSAxLjg1IDAgMCAwLS43Mi0uNDkgMy4yNSAzLjI1IDAgMCAwLTEuMTUtLjIxIDkuNzYgOS43NiAwIDAgMC0xLjY5LjE3IDcuNyA3LjcgMCAwIDAtMS4yNi4zbC0uMzItMi4xOWExMiAxMiAwIDAgMSAzLjU1LS41MnptLTgtMS4yOGExLjYyIDEuNjIgMCAxIDEgMS42LTEuNTggMS42MiAxLjYyIDAgMCAxLTEuNjMgMS41OHptMS4zNSAxMy4yM2gtMi42OXYtMTEuNTRsMi42OS0uNDJ2MTJ6bS00LjcyIDBjLTQuMzggMC00LjM4LTMuNTQtNC4zOC00LjExdi0xMy4zNGwyLjY3LS40MnYxMy4yNWMwIC4zMiAwIDIuMzYgMS43MiAyLjM3djIuMjR6bS04LjctNS45MWE0LjczIDQuNzMgMCAwIDAtLjc0LTIuNzkgMi42MiAyLjYyIDAgMCAwLTQuMTMgMCA0LjY4IDQuNjggMCAwIDAtLjc0IDIuNzkgNC4xOCA0LjE4IDAgMCAwIC43NCAyLjYzIDIuNCAyLjQgMCAwIDAgMi4wNyAxIDIuNDMgMi40MyAwIDAgMCAyLjA3LTEgNC4yIDQuMiAwIDAgMCAuNzMtMi42M3ptMi43NCAwYTYuNDQgNi40NCAwIDAgMS0uNCAyLjMzIDUuNDYgNS40NiAwIDAgMS0xLjEyIDEuOSA0Ljg5IDQuODkgMCAwIDEtMS43NiAxLjIyIDcgNyAwIDAgMS0yLjI2LjQ1IDYuNjUgNi42NSAwIDAgMS0yLjI1LS40NSA1LjA3IDUuMDcgMCAwIDEtMS43NS0xLjIyIDUuNzEgNS43MSAwIDAgMS0xLjEzLTEuOSA2LjIzIDYuMjMgMCAwIDEtLjQ2LTIuMzMgNy4zOSA3LjM5IDAgMCAxIC4zOS0yLjUxIDUuNzIgNS43MiAwIDAgMSAxLjE1LTEuODkgNS4wNyA1LjA3IDAgMCAxIDEuNzUtMS4yMiA1LjY0IDUuNjQgMCAwIDEgMi4yMy0uNDIgNS44NCA1Ljg0IDAgMCAxIDIuMjQuNDIgNC44OSA0Ljg5IDAgMCAxIDEuNzYgMS4yMiA1LjY2IDUuNjYgMCAwIDEgMS4xMyAxLjg5IDYuOTIgNi45MiAwIDAgMSAuNDMgMi41MXptLTIwLjEzIDBhNC43OCA0Ljc4IDAgMCAwIC43NCAyLjg4IDIuNTEgMi41MSAwIDAgMCAxLjkxLjc4IDQgNCAwIDAgMCAxLjIxLS4xOCAzLjM1IDMuMzUgMCAwIDAgLjkxLS40MnYtNi42M2ExMC40NyAxMC40NyAwIDAgMC0xLjc3LS4yMyAyLjY4IDIuNjggMCAwIDAtMi4yMyAxIDQuNjcgNC42NyAwIDAgMC0uNzcgMi44em03LjQ0IDUuMjdhNS4xMiA1LjEyIDAgMCAxLTEuNCA0IDYuMjQgNi4yNCAwIDAgMS00LjMgMS4yNyAxOC4zMSAxOC4zMSAwIDAgMS0zLjM0LS4zOWwuNDMtMi4xMmExNi44MyAxNi44MyAwIDAgMCAyLjk1LjI2IDMuMjYgMy4yNiAwIDAgMCAyLjMtLjY2IDIuNTQgMi41NCAwIDAgMCAuNjktMS45NHYtLjQ0YTkuNDcgOS40NyAwIDAgMS0xIC40IDUuNTYgNS41NiAwIDAgMS0xLjQ5LjE5IDUuNDYgNS40NiAwIDAgMS0yLS4zNSA0LjMxIDQuMzEgMCAwIDEtMS41Ny0xIDQuNjkgNC42OSAwIDAgMS0xLTEuNyA5Ljc5IDkuNzkgMCAwIDEtLjM2LTIuNzcgOC41NiA4LjU2IDAgMCAxIC4zOC0yLjU4IDUgNSAwIDAgMSAxLjEzLTEuNzkgNS4wOCA1LjA4IDAgMCAxIDEuOC0xLjE2IDYuNTIgNi41MiAwIDAgMSAyLjM0LS40OCAxNC42NCAxNC42NCAwIDAgMSAyLjQ1LjI0IDE5LjgzIDE5LjgzIDAgMCAxIDIgLjQxdjEwLjYxeiIvPjxwYXRoIGlkPSJzdmdfMyIgY2xhc3M9ImNscy0zIiBkPSJNNyA2LjY4djEuNjJhNC41MSA0LjUxIDAgMCAwLTIuNDItLjY3IDIuMTggMi4xOCAwIDAgMC0xLjQxLjM3IDEuMjYgMS4yNiAwIDAgMC0uNTEgMSAxLjIyIDEuMjIgMCAwIDAgLjUgMSA2LjczIDYuNzMgMCAwIDAgMS41Mi44M2MuNDQuMi43OS4zNiAxIC41YTYuODUgNi44NSAwIDAgMSAuODYuNTggMi4yMiAyLjIyIDAgMCAxIC43Mi45IDIuOTIgMi45MiAwIDAgMSAuMjMgMS4xOCAyLjczIDIuNzMgMCAwIDEtMSAyLjI0IDQgNCAwIDAgMS0yLjYxLjgxIDUuNzUgNS43NSAwIDAgMS0yLjg4LS42MXYtMS43MWE0LjcyIDQuNzIgMCAwIDAgMi45Mi45NCAyLjE5IDIuMTkgMCAwIDAgMS4zOS0uNDEgMS4zNSAxLjM1IDAgMCAwIC41MS0xLjEyIDEuMiAxLjIgMCAwIDAtLjMtLjc5IDIuMTggMi4xOCAwIDAgMC0uNjYtLjU0bC0xLS41MS0uNjQtLjI5Yy0uMTktLjA5LS4zNy0uMTktLjU1LS4yOWEzLjM2IDMuMzYgMCAwIDEtLjU3LS4zNSA1LjcyIDUuNzIgMCAwIDEtLjQ2LS40IDEuNzQgMS43NCAwIDAgMS0uMzktLjUxIDQuOTIgNC45MiAwIDAgMS0uMjUtLjU3IDIuMzQgMi4zNCAwIDAgMS0uMS0uNzUgMi42NiAyLjY2IDAgMCAxIDEuMDItMi4xMyA0IDQgMCAwIDEgMi41OC0uODMgNS40NyA1LjQ3IDAgMCAxIDIuNS41MXptNy40NyA1LjY5di0uMjhhMi4zMiAyLjMyIDAgMCAwLS40Ny0xLjQ1IDEuNjUgMS42NSAwIDAgMC0xLjMzLS41MyAxLjg0IDEuODQgMCAwIDAtMS4zNy41OCAyLjkgMi45IDAgMCAwLS43MiAxLjY4em0xIDIuNzl2MS40MWE0Ljc5IDQuNzkgMCAwIDEtMi4zNy41MSA0LjA2IDQuMDYgMCAwIDEtMy0xLjEzIDQuMDggNC4wOCAwIDAgMS0xLjEtMi45NSA0LjM1IDQuMzUgMCAwIDEgMS0zLjA2IDMuMzggMy4zOCAwIDAgMSAyLjYtMS4xMSAzLjI1IDMuMjUgMCAwIDEgMi40NiAxIDMuOTMgMy45MyAwIDAgMSAuOTQgMi43MyA2LjQxIDYuNDEgMCAwIDEtLjEgMWgtNS4zNWEyLjM0IDIuMzQgMCAwIDAgLjg5IDEuNjEgMyAzIDAgMCAwIDEuODUuNTYgMy42NSAzLjY1IDAgMCAwIDIuMTYtLjU3em02LjYtMS43NmgtMS4yM2EyLjEzIDIuMTMgMCAwIDAtMS4zNS4zNSAxLjA4IDEuMDggMCAwIDAtLjQ1Ljg5IDEuMTIgMS4xMiAwIDAgMCAuMzUuODggMS40NyAxLjQ3IDAgMCAwIDEgLjMyIDEuNjYgMS42NiAwIDAgMCAxLjItLjQzIDEuNDggMS40OCAwIDAgMCAuNDQtMS4xMXYtLjkxem0tNC4wNy0yLjU2di0xLjUxYTQuODkgNC44OSAwIDAgMSAyLjQ5LS41NXEzLjE4IDAgMy4xOCAzLjA4djUuMTRoLTEuNTd2LTFhMi4zNiAyLjM2IDAgMCAxLTIuMTkgMSAyLjU2IDIuNTYgMCAwIDEtMS44NC0uNjYgMi4yMiAyLjIyIDAgMCAxLS42OS0xLjY4IDIuMTIgMi4xMiAwIDAgMSAuODctMS44MSA0LjExIDQuMTEgMCAwIDEgMi40Ni0uNjVoMS4zNHYtLjRhMS43NCAxLjc0IDAgMCAwLS40LTEuMjUgMS43NiAxLjc2IDAgMCAwLTEuMzItLjQzIDQuMTcgNC4xNyAwIDAgMC0yLjM1Ljcyem05LjM0LTEuOTN2MS40MmEyLjEzIDIuMTMgMCAwIDEgMi4xMi0xLjUgMyAzIDAgMCAxIC40OS4wNXYxLjUzYTEuNzYgMS43NiAwIDAgMC0uNzUtLjE0IDEuNiAxLjYgMCAwIDAtMS4zNC43MiAyLjc3IDIuNzcgMCAwIDAtLjUyIDEuN3Y0LjMxaC0xLjU5di04LjA5em01IDQuMDlhMyAzIDAgMCAwIC43NSAyIDIuNTYgMi41NiAwIDAgMCAyIC43OSAzLjI3IDMuMjcgMCAwIDAgMS43OC0uNTJ2MS40YTMuNzQgMy43NCAwIDAgMS0yIC40OCA0IDQgMCAwIDEtMy0xLjIgNC4xNSA0LjE1IDAgMCAxLTEuMTQtMyA0LjI1IDQuMjUgMCAwIDEgMS4xNC0zIDQgNCAwIDAgMSAzLjA5LTEuMjMgNC4yOCA0LjI4IDAgMCAxIDEuOTMuNDR2MS40NGEzLjM0IDMuMzQgMCAwIDAtMS43Ny0uNSAyLjY3IDIuNjcgMCAwIDAtMiAuOCAyLjg4IDIuODggMCAwIDAtLjc5IDIuMXptNy45MS03LjI4djQuNThhMi44MyAyLjgzIDAgMCAxIDQuNC0uNzcgMi44IDIuOCAwIDAgMSAuNzIgMi4wNXY1LjQyaC0xLjU3di01LjExYTEuODEgMS44MSAwIDAgMC0uNDItMS4yOCAxLjQ4IDEuNDggMCAwIDAtMS4xMS0uNDYgMiAyIDAgMCAwLTEuNDEuNjEgMi41IDIuNSAwIDAgMC0uNjIgMS44NXY0LjM5aC0xLjU2di0xMS4yOHptMTUgMTBhMS44NiAxLjg2IDAgMCAwIDEuNS0uNzYgMyAzIDAgMCAwIC42LTIgMy4zIDMuMyAwIDAgMC0uNi0yLjEyIDEuOTMgMS45MyAwIDAgMC0xLjU1LS43NCAyLjA3IDIuMDcgMCAwIDAtMS40OS42NyAyLjgzIDIuODMgMCAwIDAtLjcxIDIuMTMgMy4xMyAzLjEzIDAgMCAwIC42NCAyLjEgMiAyIDAgMCAwIDEuNTcuNzR6bS0yLjI1LTEwdjQuNDJhMi43NiAyLjc2IDAgMCAxIDIuNDQtMS4zNCAzLjEyIDMuMTIgMCAwIDEgMi41NiAxLjIgNC41NCA0LjU0IDAgMCAxIDEgMy4wNSA0LjcgNC43IDAgMCAxLTEgMi44NiAzIDMgMCAwIDEtMi41NCAxLjIgMi43MyAyLjczIDAgMCAxLTIuNDYtMS4zNHYxLjIzaC0xLjU4di0xMS4yOHptOS45MSAxMS4xbC0zLjIyLTcuOTFoMS43NGwxIDIuNjMgMS4yNiAzLjQ2Yy4xLS4zMi40OC0xLjQ2IDEuMTUtMy40MmwuOTEtMi42M2gxLjY2bC0yLjkyIDcuODdxLTEuMTUgMy4xMS0zLjU2IDMuMTFhMyAzIDAgMCAxLS43My0uMDh2LTEuMzhhMi4zNSAyLjM1IDAgMCAwIC41NC4wNiAyLjIyIDIuMjIgMCAwIDAgMi4xNy0xLjcxeiIvPjxwYXRoIGlkPSJzdmdfNCIgY2xhc3M9ImNscy00IiBkPSJNODkuNjMgNnYtLjhhMSAxIDAgMCAwLTEtMWgtMi4yNmExIDEgMCAwIDAtMSAxdi44YS4xMy4xMyAwIDAgMCAuMTcuMTMgNyA3IDAgMCAxIDItLjI4IDcuMjkgNy4yOSAwIDAgMSAxLjkyLjI2LjEzLjEzIDAgMCAwIC4xNy0uMTFtLTYuMjUgMWwtLjM4LS40MWExIDEgMCAwIDAtMS4zOCAwbC0uNDYuNDZhMSAxIDAgMCAwIDAgMS4zOGwuMzguMzlhLjE1LjE1IDAgMCAwIC4yMSAwIDcuNTcgNy41NyAwIDAgMSAuNzQtLjg3IDYuODUgNi44NSAwIDAgMSAuODgtLjc1LjEzLjEzIDAgMCAwIDAtLjJtNC4xNiAyLjQ1djMuMzRhLjE0LjE0IDAgMCAwIC4yLjEybDMtMS41NGEuMTMuMTMgMCAwIDAgLjA1LS4xOCAzLjY5IDMuNjkgMCAwIDAtMy4xLTEuODkuMTMuMTMgMCAwIDAtLjEzLjEzbTAgOC4wNWE0LjQ4IDQuNDggMCAxIDEgNC40NS00LjQ4IDQuNDkgNC40OSAwIDAgMS00LjQ4IDQuNDhtMC0xMC44NWE2LjM3IDYuMzcgMCAxIDAgNi40IDYuMzcgNi4zNiA2LjM2IDAgMCAwLTYuMzYtNi4zNiIvPjwvZz48L3N2Zz4=">
      </a>
    </div>

    <div id="hits" class="mt0 mb4 f4 fw1 f4-ns normal lh-copy lh-title-ns">
      <!-- Hits widget will appear here -->
    </div>

    <div id="pagination">
      <!-- Pagination widget will appear here -->
    </div>

    <div id="articles-init">
      {{ range .Data.Pages.GroupByDate "2006" }}
      <h2 class="mb1">{{ .Key }}</h2>
      <div class="flex-auto flex flex-column justify-center pv4 pv3-ns">
        {{ range .Pages.ByPublishDate.Reverse }}
        <div class="mb4 w-70-l">
          <a class="dib no-underline w-100 background-hover" href="{{ .Permalink }}">
            <h2 class="f7 fw3 mt1 mb0 ttu tracked black-60">{{ .PublishDate.Format "02 January" }}</h2>
            <h1 class="mt0 f4 fw1 f4-ns normal lh-copy black-70 lh-title-ns">{{ .Title }}</h1>
          </a>
        </div>
        {{ end }}
      </div>
      {{ end }}
    </div>

    <!-- {{ range .Data.Pages.GroupByDate "2006" }}
      <h2 class="">{{ .Key }}</h2>
        <div class="flex-auto flex flex-column justify-center pv4 pv3-ns">
          {{ range .Pages.ByPublishDate.Reverse }}
          <a class="dib no-underline black-70 color-animate hover-gray" href="{{ .Permalink }}">
            <h2 class="f7 fw3 mt1 mb0 ttu tracked gray">{{ .PublishDate.Format "02 January" }}</h2>
            <h1 class="mt0 mb4 f4 fw1 f4-ns normal lh-copy lh-title-ns">{{ .Title }}</h1>
          </a>
          {{ end }}
        </div>
      {{ end }} -->

    {{ partialCached "footer" . }}

  </div>
  <script type="module">

    // initialize instantsearch
    const searchClient = algoliasearch('{{ getenv "ALGOLIA_APP_ID" }}', '{{ getenv "ALGOLIA_SEARCH_KEY" }}');

    const insightsMiddleware = instantsearch.middlewares.createInsightsMiddleware({
      insightsClient: window.aa,
    });

    const search = instantsearch({
      indexName: '{{ getenv "ALGOLIA_INDEX_NAME" }}',
      searchClient,
      routing: {
        router: instantsearch.routers.history({
          windowTitle({ query }) {
            const queryTitle = query ? `Search Results for "${query}"` : 'Articles';
            return queryTitle;
          },

          createURL({ qsModule, routeState, location }) {
            const urlParts = location.href.match(/^(.*?)\/articles/);
            const baseUrl = `${urlParts ? urlParts[1] : ''}/`;
            const queryParameters = {};
            if (routeState.query) {
              queryParameters.search = encodeURIComponent(routeState.query);
            }

            const queryString = qsModule.stringify(queryParameters, {
              addQueryPrefix: true,
              arrayFormat: 'repeat'
            });

            console.log(routeState);
            console.log(baseUrl + 'articles/' + queryString);
            return `${baseUrl}articles/${queryString}`;
          },

          parseURL({ qsModule, location }) {
            const { search = '' } = qsModule.parse(
              location.search.slice(1)
            );
            return {
              query: decodeURIComponent(search),
            };
          },
        }),

        stateMapping: {
          stateToRoute(uiState) {
            const indexUiState = uiState['{{ getenv "ALGOLIA_INDEX_NAME" | safeJS }}'];
            return {
              query: indexUiState.query
            };
          },

          routeToState(routeState) {
            return {
              ['{{ getenv "ALGOLIA_INDEX_NAME" | safeJS }}']: {
                query: routeState.query
              },
            };
          },
        },

      },
      searchFunction: function (helper) { // https://community.algolia.com/instantsearch.js/v1/documentation/#hide-results-on-init
        var searchResults = $('#hits');
        var articlesInit = $('#articles-init');
        if (helper.state.query === '') {
          searchResults.hide();
          articlesInit.show();
          return;
        }
        helper.search();
        articlesInit.hide();
        searchResults.show();
      }
    });

    search.use(insightsMiddleware);

    let timerId;

    search.addWidget(
      instantsearch.widgets.configure({
        //hitsPerPage: 10,
        attributesToHighlight: [
          "title"
        ],
        attributesToRetrieve: [
          "title",
          "publishdate",
          "permalink"
        ]
      })
    );

    search.addWidget(
      instantsearch.widgets.searchBox({
        container: '#search-box',
        autofocus: false,
        showSubmit: false,
        placeholder: 'Search...',
        queryHook(query, refine) {
          clearTimeout(timerId);
          timerId = setTimeout(() => refine(query), 400);
        }
      })
    );

    search.addWidget(
      instantsearch.widgets.hits({
        container: '#hits',
        transformItems: function (items) {
          return items.map(item => ({
            ...item,
            humandate: dayjs(item.publishdate).format('D MMMM YYYY')
          }));
        },
        templates: {
          empty: 'No results',
          item: (hit, bindEvent) => `
          <div class="mb4 w-70-l">
            <a ${bindEvent("click", hit, "Article Search Result Clicked")} class="dib no-underline w-100 background-hover" href="${hit.permalink}">
              <h2 class="f7 fw3 mt1 mb0 ttu tracked black-60">
                ${hit.humandate}
              </h2>
              <h1 class="mt0 f4 fw1 f4-ns normal lh-copy black-70 lh-title-ns">
                ${instantsearch.highlight({ attribute: 'title', hit })}
              </h1>
            </a>
          </div>
          `
        }
      })
    );

    // search.addWidget(
    //   instantsearch.widgets.pagination({
    //     container: '#pagination',
    //   }),
    // )

    search.start();

    // add aria-label to input (accessibility)
    document.querySelector('.ais-SearchBox-input').setAttribute('aria-label', 'Search');
  </script>
</body>

</html>